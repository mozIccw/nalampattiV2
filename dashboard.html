<!DOCTYPE html>
<html lang="en">

    <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Dashboard for Nallampatti water and health data, presented by ICCW.">
    <meta name="author" content="ICCW">
    <meta name="keywords" content="Dashboard, Water, Health, Nallampatti, ICCW, Data, Analysis, Chart.js">
    <meta name="robots" content="index, follow">
    <meta name="theme-color" content="#007bff">
    <link rel="apple-touch-icon" sizes="180x180" href="Fevicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="Fevicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="Fevicon/favicon-16x16.png">
    
    <title>Dashboard - Nallampatti</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="Dashboard.css">
    <link rel="stylesheet" href="styles.css">
    
    <!-- Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body style="display: flex; flex-direction: column; min-height: 100vh; margin: 0;">
    <header>
        <div class="navbar">
            <!-- Left side: Site logo -->
            <div class="logo-container">
                <img src="Logos\iccw-logo-white.png" alt="ICCW Logo" class="logo">
                <span class="site-name">Nallampatti</span>
            </div>
    
            <!-- Right side: Navigation menu and Partner logo -->
            <div class="nav-and-partner">
                <!-- Navigation links -->
                <nav>
                    <ul class="nav-links">
                        <li><a href="index.html" class="nav-item">Home</a></li>
                        <li><a href="project-insights.html" class="nav-item">Project Insights</a></li>
                        <li><a href="dashboard.html" class="nav-item active">Dashboard</a></li>
                        <li><a href="gallery.html" class="nav-item">Gallery</a></li>
                        <li><a href="contact-us.html" class="nav-item">Contact Us</a></li>
                    </ul>
                </nav>
    
                <!-- Partner logo -->
                <div class="partner-logo-container">
                    <img src="Logos\IITM-500x500.png" alt="IITM Logo" class="partner-logo">
                </div>
            </div>
        </div>
    </header>

        <!-- Sidebar -->
        <div class="sidebar">
            <ul>
                <li id="years-button">
                    <a href="#">
                        <i class="fa fa-calendar"></i>
                        <div>Select Year</div>
                    </a>
                </li>
                <div id="years-content" class="hidden">
                    <li id="2021-active">
                        <a href="#" id="year-2021">
                            <i class="fa fa-caret-right"></i>
                            <div>2021</div>
                        </a>
                    </li>
                    
                    <li id="year-2022-hover">
                        <a href="#">
                            <i class="fa fa-caret-right"></i>
                            <div>2022</div>
                        </a>
                        <!-- Sub-options for "2022" -->
                        <ul class="sub-options hidden" id="year-2022-options">
                            <li>
                                <a href="#" id="health-survey-dashboard">Health Survey</a>
                            </li>
                            <li>
                                <a href="#" id="water-quality-dashboard">Water Quality</a>
                            </li>
                        </ul>
                    </li>
                    <li>
                        <a href="#" id="year-2024">
                            <i class="fa fa-caret-right"></i>
                            <div>2024 (Live)</div>
                            <i class="fa fa-circle blinking" style="color: #5bf36b;"></i>

                        </a>
                    </li>
                </div>
            </ul>
        </div>
        <!-- Main Dashboard Content -->
        <!-- Health Survey Dashboard -->

        <div class="main-dashboard hidden" id="health-dashboard-content" style="overflow-y: auto; max-height: calc(100vh - 150px); padding-top: 10px;">
            <div class="row col-md-12">
      
   
        <!-- Cards for Health Survey Data -->
        <div class="col-md-3" style="padding-right: 3px; padding-left: 3px;">
            <div class="card" style="max-height: 142px;padding: 10px;display: flex;justify-content: space-between;box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);border-radius: 10px;flex-direction: row;height: 85px;">
                <div class="card-content" style="flex-grow: 1; text-align: left;">
                    <div class="number" style="font-size: 24px; font-weight: bold; color: #00bfff;">3,874</div>
                    <div class="card-name" style="font-size: 12px; color: #333;">Total Population</div>
                </div>
                <div class="icon-box" style="font-size: 24px; color: #333;">
                    <i class="fa fa-users"></i>
                </div>
            </div>
        </div>
        
        <div class="col-md-3" style="padding-right: 3px; padding-left: 3px;">
            <div class="card" style="max-height: 142px;padding: 10px;display: flex;justify-content: space-between;box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);border-radius: 10px;flex-direction: row;height: 85px;">
                <div class="card-content" style="flex-grow: 1; text-align: left;">
                    <div class="number" style="font-size: 24px; font-weight: bold; color: #00bfff;">1,537</div>
                    <div class="card-name" style="font-size: 12px; color: #333;">Surveyed Population</div>
                </div>
                <div class="icon-box" style="font-size: 24px; color: #333;">
                    <i class="fa fa-server"></i>
                </div>
            </div>
        </div>
        
        <div class="col-md-3" style="padding-right: 3px; padding-left: 3px;">
            <div class="card" style="max-height: 142px;padding: 10px;display: flex;justify-content: space-between;box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);border-radius: 10px;flex-direction: row;height: 85px;">
                <div class="card-content" style="flex-grow: 1; text-align: left;">
                    <div class="number" style="font-size: 24px; font-weight: bold; color: #00bfff;">446</div>
                    <div class="card-name" style="font-size: 12px; color: #333;">Individuals reported with diseases</div>
                </div>
                <div class="icon-box" style="font-size: 24px; color: #333;">
                    <i class="fa fa-stethoscope"></i>
                </div>
            </div>
        </div>
        
        <div class="col-md-3" style="padding-right: 3px; padding-left: 3px;">
            <div class="card" style="max-height: 142px;padding: 10px;display: flex;justify-content: space-between;box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);border-radius: 10px;flex-direction: row;height: 85px;">
                <div class="card-content" style="flex-grow: 1; text-align: left;">
                    <div class="number" style="font-size: 24px; font-weight: bold; color: #00bfff;">1,092</div>
                    <div class="card-name" style="font-size: 12px; color: #333;">Individuals reported with no disease</div>
                </div>
                <div class="icon-box" style="font-size: 24px; color: #333;">
                    <i class="fa fa-heartbeat"></i>
                </div>
            </div>
        </div>
        
    </div>
    
    
<!-- Charts for Health Survey -->
<div class="row mt-2 col-md-12">
    <div class="col-md-6" style="padding: 2px;">
        <div class="chart-container">
            <canvas id="lineChart"></canvas>
        </div>
    </div>
    
    <div class="col-md-6" style="padding: 2px;">
        <div class="chart-container">
            <canvas id="doughnut"></canvas>
        </div>
    </div>
</div>
<div class="row mt-4 col-md-12">
    <div class="col-md-6" style="padding: 2px;">
        <div class="chart-container">
            <canvas id="polarChart"></canvas>
        </div>
    </div>
    <div class="col-md-6" style="padding: 2px;">
        <div class="chart-container">
            <canvas id="multiSeriesPieChart"></canvas>
        </div>
    </div>
</div>

</div>


        
        <!-- Water Quality Dashboard -->
        <div class="main-dashboard hidden" id="water-dashboard-content">
            <div class="row">
                <!-- Left side large container - col-md-9 -->
                <div class="col-md-10">
                    <!-- Container covering 3/4th of the page -->
                    <div class="large-container">
                        <iframe src="2022.html" title="2022 Water Quality Data" style="width: 100%;height: 73vH;"></iframe>
                    </div>
                </div>
        
                <!-- Right side with stacked cards - col-md-3 -->
                <div class="col-md-2 d-flex flex-column">
                    <!-- 4 Ticker Boxes -->
                    <div class="card mb-3">
                        <div class="card-content text-center">
                            <div class="card-name" style="background: #061a3a; color: white;">Year: 2022</div>
                       </div>
                       
                       
                    </div>
                    <div class="card mb-3">
                        <div class="card-content text-center">
                            <div class="card-name">Borewell</div>
                            <div class="number">8</div>
                           
                        </div>
                       
                    </div>
                    <div class="card mb-3">
                        <div class="card-content text-center">
                            <div class="card-name">Openwell</div>
                            <div class="number">22</div>
                            
                        </div>
                       
                    </div>
                    <div class="card mb-3">
                        <div class="card-content text-center">
                            <div class="card-name">Above Permissible</div>
                            <div class="number">  <img src="redpin.png" style="width: 30px;"></div>
                           
                            
                        </div>
                       
                    </div>
                    <div class="card mb-3">
                        <div class="card-content text-center">
                            <div class="card-name">Desirable Values</div>
                            <div class="number">  <img src="bluepin.png" style="width: 30px;"></div>
                        
                            
                        </div>
                       
                    </div>
                      <!-- New Water Quality Data Section -->
            <div class="card mb-3" style="margin-bottom: 4px!important;">
                <div class="card-content text-center" style="min-height: 70px;padding: 1px;">
                    <h6 style="font-size: 18px;font-weight: 600;"> Water Quality Data - 2022</h6> <a href="Nalampatti_WaterQuality2022_download_ICCW.pdf" 
                    target="_blank" class="btn btn-primary" style="background-color: #061a3a;font-size: 12px;font-weight: 600;"> Download </a></div>
            </div>
                </div>
            </div> 
        </div>

       <!-- 2021 Dashboard -->
<div class="main-dashboard hidden" id="dashboard-2021">
    <div class="row">
        <!-- Left side large container - col-md-9 -->
        <div class="col-md-10" style="padding-right: 2px;">
            <!-- Container covering 3/4th of the page -->
            <div class="large-container">
                <iframe src="2021.html" title="2021 Water Quality Data" style="width: 100%;height: 73vH;"></iframe>
            </div>
        </div>

        <!-- Right side with stacked cards - col-md-3 -->
        <div class="col-md-2 d-flex flex-column">
            <!-- 4 Ticker Boxes -->
            <div class="card mb-3">
                <div class="card-content text-center">
                    <div class="card-name" style="background: #061a3a; color: white;">Year: 2021</div>
                </div>
            </div>
            <div class="card mb-3">
                <div class="card-content text-center">
                    <div class="card-name">No. of Borewells</div>
                    <div class="number">8</div>
                </div>
            </div>
            <div class="card mb-3">
                <div class="card-content text-center">
                    <div class="card-name">No. of Openwells</div>
                    <div class="number">22</div>
                </div>
            </div>
            <div class="card mb-3">
                <div class="card-content text-center">
                    <div class="card-name">Values Above Permissible</div>
                    <div class="number"><img src="redpin.png" style="width: 30px;"></div>
                </div>
            </div>
            <div class="card mb-3">
                <div class="card-content text-center">
                    <div class="card-name">Desirable Values</div>
                    <div class="number"><img src="bluepin.png" style="width: 30px;"></div>
                </div>
            </div>
            <!-- New Water Quality Data Section -->
            <div class="card mb-3" style="margin-bottom: 4px!important;">
                <div class="card-content text-center" style="min-height: 70px;padding: 1px;">
                    <h6 style="font-size: 14px;font-weight: 600;"> Water Quality Data - 2021</h6> <a href="Nalampatti_WaterQuality2021_download_ICCW.pdf" 
                    target="_blank" class="btn btn-primary" style="background-color: #061a3a;font-size: 12px;font-weight: 600;"> Download </a></div>
            </div>
        </div>
        
    </div>
</div>
<!-- 2024 Dashboard -->
<div class="main-dashboard hidden" id="dashboard-2024">
    <div class="container mt-3">
        <div class="row mt-2 col-md-12">
           <!-- Water Level Card -->
           <div class="col-md-5">
         
            <div class="card card1" style="padding: 20px;">
			<div class="water-percentage" style="visibility: hidden;">Loading...</div>
			<div class="meter-card-2 charts">
				<div class="water-tank">
					<div class="liquid">
						<svg id="water-svg" class="water" viewBox="0 0 200 100" preserveAspectRatio="xMidYMid meet" width="100%" height="100%">
    <defs>
        <!-- Gradient for Modern Browsers -->
        <linearGradient id="waterGradient" x1="0%" y1="0%" x2="0%" y2="100%">
            <stop offset="0" style="stop-color:#29ABE2;" />
            <stop offset="0.1643" style="stop-color:#28A6E3;" />
            <stop offset="0.3574" style="stop-color:#2496E6;" />
            <stop offset="0.5431" style="stop-color:#1E7DEA;" />
            <stop offset="0.7168" style="stop-color:#1559F0;" />
            <stop offset="0.874" style="stop-color:#0B2CF7;" />
            <stop offset="1" style="stop-color:#0000FF;" />
        </linearGradient>
        <!-- Gradient with WebKit-Specific Prefix for Safari -->
        <linearGradient id="waterGradient-webkit" x1="0%" y1="0%" x2="0%" y2="100%">
            <stop offset="0" style="stop-color:#29ABE2;" />
            <stop offset="0.1643" style="stop-color:#28A6E3;" />
            <stop offset="0.3574" style="stop-color:#2496E6;" />
            <stop offset="0.5431" style="stop-color:#1E7DEA;" />
            <stop offset="0.7168" style="stop-color:#1559F0;" />
            <stop offset="0.874" style="stop-color:#0B2CF7;" />
            <stop offset="1" style="stop-color:#0000FF;" />
        </linearGradient>
    </defs>
    <!-- Use both gradients for compatibility -->
    <path fill="url(#waterGradient-webkit)" d="M 0,0 v 100 h 200 v -100 
        c -5,0 -8,2 -13,2 c -5,0 -8,-2 -13,-2
        c -5,0 -8,2 -13,2 c -5,0 -8,-2 -13,-2
        c -5,0 -8,2 -13,2 c -5,0 -8,-2 -13,-2
        c -5,0 -8,2 -13,2 c -5,0 -8,-2 -13,-2
    " />
</svg>

					</div>
					<!-- Indicators for different levels -->
					<div class="indicator" data-value="100">&nbsp;72 ft.</div>
					<div class="indicator" data-value="85">&nbsp;60 ft.</div> 
					<div class="indicator" data-value="70">&nbsp;48 ft.</div> 
					<div class="indicator" data-value="55">&nbsp;36 ft.</div> 
					<div class="indicator" data-value="40">&nbsp;24 ft.</div> 
					<div class="indicator" data-value="25">&nbsp;12 ft.</div> 
					<div class="indicator" data-value="0">&nbsp;0 ft.</div> 
					<div class="label" id="water-level"></div>
				</div>
			</div>
		</div>

          
            <div class="col-md-5 mt-2 card card1" style="min-width: 100%;">
                <span style="font-size: 14px;font-weight: bold;background-color: rgb(7, 23, 69);color: white;text-align: center;">
                    Installed IoT Devices
                </span>
                <div class="image-gallery">
                    <img src="site1.jpg" alt="Image 1" class="thumbnail" onclick="openModal(this.src)">
                    <img src="site2.jpg" alt="Image 2" class="thumbnail" onclick="openModal(this.src)">
                     <video src="WaterLevelSensor.mp4" class="thumbnail" onclick="openModal(this.src)" >
                        Your browser does not support the video tag.
                    </video>
                </div>
            </div>
            
            <!-- Modal -->
            <div id="imageModal" class="modal">
                <span class="close" onclick="closeModal()">&times;</span>
                <div class="modal-content">
                    <img id="modalImage" style="display: block;max-width: 768px;max-height: 421px;" alt="Modal Image">
                    <video id="modalVideo" style="display: none;max-width: 100%;" controls>
                        Your browser does not support the video tag.
                    </video>
                </div>
            </div>
                
       

</div>

    
            <!-- TDS and pH Values Section -->
            <div class="col-md-7" style="padding: 2px;">
                <div class="card" style="padding: 10px;background: #ffffff;border-radius: 6px;">
                    
                    <h5  class="label" style="text-align: center;background: #061a39;font-size: 1rem;color: white;line-height: 1.4rem;font-weight: 600;">Water Quality Parameters</h5>
                    <div class="row" style="display: flex;gap: 10px;align-items: baseline;justify-content: center;align-content: stretch;flex-wrap: nowrap;">
                        <!-- TDS Card -->
                        <div class="col-md-6"style="
                            background-color: #06193847;
                            border-radius: 10px;
                            box-shadow: 0 4px 8px rgb(0 174 207 / 28%);
                            padding: 10px;
                            text-align: center;
                            width: 100%;
                            max-width: 275px;
                        ">
                       
                            <div class="tds-value" style="font-size: 20px; font-weight: bold; color: #061a3a;">Loading...</div>
                        </div>
                    
                        <!-- pH Card -->
                        <div class="col-md-6" style="
                            background-color: #33e14147;
                            border-radius: 10px;
                            box-shadow: 0 4px 8px rgb(0 174 207 / 28%);
                            padding: 8px;
                            text-align: center;
                            width: 100%;
                            max-width: 275px;
                        ">
                           
                            <div class="ph-value" style="font-size: 20px; font-weight: bold; color: #061a3a;">Loading...</div>
                        </div>
                
                    </div>
                    
                </div>
                <div class="card mt-2" style="padding: 10px; background: #ffffff; border-radius: 6px;">
                    <div class="container" style="display: flex; align-items: center;">
                        <div style="flex: 1; display: flex; align-items: center; margin-right: 10px;">
                            <span style="font-size: 14px; font-weight: bold;">Select Parameter:&nbsp;&nbsp; </span>
                            <select id="chart-selector" class="styled-select" style="width: 50%;">
                                <option value="TDS">&nbsp; TDS Chart</option>
                                <option value="pH">&nbsp; pH Chart</option>
                            </select>
                        </div>
                        <div style="flex: 1; text-align: center;">
                            <span id="live-data-date" style="font-size: 14px; font-weight: bold;">Live Data - </span>
                            <span id="today-date" style="font-size: 14px; font-weight: bold;"></span>
                            <button class="btn btn-primary" id="refresh-button" style="font-size: 11px; font-weight: bold; margin-left: 5px; border-radius: 12px; background-color: #061a39;">
                                Refresh Data
                            </button>
                        </div>
                        
                        
                    </div>
                    <canvas id="myChartss" style="margin-top: 10px;"></canvas>
                </div>
                
                
                
            </div>
        </div>
    </div>
</div>
</div>

  
 

  <!-- Chart.js Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@3.5.1/dist/chart.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  <!-- Include jQuery first -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

  <!-- Your Chart.js files -->
  <script src="chart1.js"></script>
  <script src="chart2.js"></script>
  <script src="chart4.js"></script>
  <script src="chart5.js"></script>
   
        <!-- Footer Section -->
<footer style="background-color: #061a3a;color: #fff;padding: 1rem;text-align: center;margin-top: auto;">
    <div class="footer-content">
        <!-- Left side: Developed by ICCW -->
        <div class="left-text">
            <p>Developed by ICCW</p>
        </div>

        <!-- Center: Social Media Icons -->
        <div class="social-icons">
            <!-- Facebook -->
            <a href="https://www.facebook.com/ICCWIndia" target="_blank" rel="noopener noreferrer">
                <i class="fab fa-facebook-f"></i>
            </a>

            <!-- LinkedIn -->
            <a href="https://www.linkedin.com/company/iccw/" target="_blank" rel="noopener noreferrer">
                <i class="fab fa-linkedin-in"></i>
            </a>

            <!-- Twitter -->
            <a href="https://x.com/ICCWIndia" target="_blank" rel="noopener noreferrer">
                <i class="fab fa-twitter"></i>
            </a>

            <!-- Instagram -->
            <a href="https://www.instagram.com/iccw_iitm/" target="_blank" rel="noopener noreferrer">
                <i class="fab fa-instagram"></i>
            </a>

            <!-- YouTube-->
            <a href="https://www.youtube.com/@iccwnews7325" target="_blank" rel="noopener noreferrer">
                <i class="fab fa-youtube"></i>
            </a>
        </div>

        <!-- Right side: All Rights Reserved -->
        <div class="right-text">
            <p>© 2020 ICCW. All Rights Reserved.</p>
        </div>
    </div>
</footer>
   <!-- Main Script -->

   <script>
  const sidebar = document.querySelector('.sidebar');
const yearsButton = document.getElementById('years-button');
const yearsContent = document.getElementById('years-content');
const healthSurveyDashboard = document.getElementById('health-survey-dashboard');
const waterQualityDashboard = document.getElementById('water-quality-dashboard');
const healthDashboardContent = document.getElementById('health-dashboard-content');
const waterDashboardContent = document.getElementById('water-dashboard-content');
const year2021 = document.getElementById('year-2021');
const dashboard2021 = document.getElementById('dashboard-2021');
const year2022 = document.getElementById('year-2022-hover');
const year2022Options = document.getElementById('year-2022-options');
const year2024 = document.getElementById('year-2024');
const dashboard2024 = document.getElementById('dashboard-2024');

// Toggle sidebar
yearsButton.addEventListener('click', function () {
    sidebar.classList.toggle('expanded');
    yearsContent.classList.toggle('hidden');
});

// Toggle 2022 sub-menu
year2022.addEventListener('click', function (e) {
    e.preventDefault();
    year2022Options.classList.toggle('hidden');
    activateMenuItem(year2022);
});

// Show specific dashboards
function showDashboard(dashboard, menuItem) {
    document.querySelectorAll('.main-dashboard').forEach(dash => dash.classList.add('hidden'));
    dashboard.classList.remove('hidden');
    activateMenuItem(menuItem);
}

// Sidebar menu item click events
healthSurveyDashboard.addEventListener('click', function () {
    showDashboard(healthDashboardContent, healthSurveyDashboard);
});
waterQualityDashboard.addEventListener('click', function () {
    showDashboard(waterDashboardContent, waterQualityDashboard);
});
year2021.addEventListener('click', function () {
    showDashboard(dashboard2021, year2021);
});
year2024.addEventListener('click', function () {
    showDashboard(dashboard2024, year2024);
});

// Highlight active menu item
function activateMenuItem(menuItem) {
    document.querySelectorAll('.sidebar ul li').forEach(item => item.classList.remove('active-background'));
    menuItem.closest('li').classList.add('active-background');
}

// Load the 2024 dashboard by default on page load
window.addEventListener('load', function () {
    // Expand the sidebar if it’s initially collapsed
    sidebar.classList.add('expanded');
    yearsContent.classList.remove('hidden');

    // Show the 2024 dashboard
    showDashboard(dashboard2024, year2024); // Show the dashboard and activate the menu item
});

</script>


<!-- Include Chart.js, date-fns, and date adapter scripts -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>


<script>
async function fetchData() {
    try {
        const response = await fetch('https://nallampatti-dashboard-api.onrender.com/sensor_data');
        const result = await response.json();
        const data = JSON.parse(result.data); // Parse the data string to JSON

        // Process water level
        const latestEntry = data[data.length - 1]; // Get the last entry
        const depth = latestEntry.Depth;

        // Constants based on well dimensions
        const totalHeight = 72;  // Total well height in feet
        const sensorOffset = 2;  // Additional feet from the sensor
        const effectiveWaterLevel = depth + sensorOffset; // Total water level from the base
        const effectiveWaterLeveltop = totalHeight - effectiveWaterLevel; // Total water level from the base

        // Calculate water level as a percentage of the total well height
        const waterLevelPercentage = (100 - ((effectiveWaterLevel / totalHeight) * 100));
        console.log(waterLevelPercentage);

        // Update water level display
        const waterPercentage = document.querySelector('.water-percentage');
        const waterLevelDiv = document.getElementById('water-level');
        const waterSvg = document.getElementById('water-svg');

        waterPercentage.textContent = `Water Level: ${waterLevelPercentage.toFixed(2)}%`;
        waterLevelDiv.textContent = `Openwell Water Level at: ${effectiveWaterLevel.toFixed(0)} Feet `;

        // Update the SVG water level by adjusting the 'top' position
        waterSvg.style.top = `calc(0% + ${waterLevelPercentage}%)`;

        // Update TDS and pH values without affecting them
        const tdsValue = latestEntry.TDS;
        const phValue = latestEntry.pH;

        document.querySelector('.tds-value').textContent = `TDS (mg/L): ${tdsValue.toFixed(2)}`;
        document.querySelector('.ph-value').textContent = `pH: ${phValue.toFixed(2)}`;

        // Create time labels for today's date including every hour in 24-hour format
        const labels = [];
        for (let i = 0; i < 24; i++) {
            labels.push(`${String(i).padStart(2, '0')}:00`); // Format to 00:00
        }

        // Create data arrays for pH and TDS values
        const pHValues = Array(labels.length).fill(null);
        const tdsValues = Array(labels.length).fill(null);
        
        data.forEach(item => {
            const date = new Date(item.timestamp);
            const hour = date.getHours();

            if (hour < labels.length) { // Ensure we are only filling valid indices
                pHValues[hour] = item.pH;
                tdsValues[hour] = item.TDS;
            }
        });
        
        // Initialize the chart with TDS data first
        createChart(labels, tdsValues, 'TDS');
        
        // Add event listener for dropdown change
        document.getElementById('chart-selector').addEventListener('change', function() {
            if (this.value === 'pH') {
                updateChart(labels, pHValues, 'pH');
            } else {
                updateChart(labels, tdsValues, 'TDS');
            }
        });

    } catch (error) {
        console.error('Error fetching data:', error);
        // Optionally handle errors here, such as displaying an error message
    }
}

// Function to create a chart
function createChart(labels, dataValues, label) {
    const ctxss = document.getElementById('myChartss').getContext('2d');
    myChartss = new Chart(ctxss, {
        type: 'line',
        data: {
            labels: labels,
            datasets: [{
                label: label,
                data: dataValues,
                borderColor: label === 'pH' ? 'blue' : 'green',
                backgroundColor: 'rgba(0, 0, 0, 0)',
                borderWidth: 1,
                pointRadius: 2, // Smaller point size
                fill: false,
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: {
                    display: false // Disable the legend
                }
            },
            scales: {
                x: {
                    title: {
                        display: true,
                        text: 'Time (HH:MM)'
                    },
                    ticks: {
                        autoSkip: false, // Show all values
                        maxRotation: 90, // Maximum rotation for label
                        minRotation: 90, // Minimum rotation for label
                    },
                    grid: {
                        color: 'rgba(200, 200, 200, 0.5)', // Light grid color
                        lineWidth: 1, // Grid line width
                    }
                },
                y: {
                    title: {
                        display: true,
                        text: label === 'pH' ? 'pH Level' : 'TDS (mg/L)'
                    },
                    min: label === 'pH' ? 4 : 100,
                    max: label === 'pH' ? 10 : 700,
                    ticks: {
                        stepSize: label === 'pH' ? 1 : 100 // Set step size for TDS
                    }
                }
            }
        }
    });
}

// Function to update the chart
function updateChart(labels, dataValues, label) {
    myChartss.data.labels = labels; // Use myChartss instead of myChart
    myChartss.data.datasets[0].data = dataValues;
    myChartss.options.scales.y.min = label === 'pH' ? 4 : 100;
    myChartss.options.scales.y.max = label === 'pH' ? 10 : 700;
    myChartss.options.scales.y.ticks.stepSize = label === 'pH' ? 1 : 100;
    myChartss.options.scales.y.title.text = label === 'pH' ? 'pH Level' : 'TDS (mg/L)';
    myChartss.update(); // Use myChartss.update() instead of myChart.update()
}

// Fetch data when the page loads
document.addEventListener('DOMContentLoaded', fetchData);

    // Function to format today's date
    function getFormattedDate() {
        const options = { year: 'numeric', month: 'long', day: 'numeric' };
        return new Date().toLocaleDateString(undefined, options);
    }

    // Display today's date in the designated span
    document.getElementById('today-date').textContent = getFormattedDate();
 function openModal(src) {
    const modal = document.getElementById('imageModal');
    const modalImage = document.getElementById('modalImage');
    const modalVideo = document.getElementById('modalVideo');
    
    // Determine if the source is a video or image based on the file extension
    if (src.endsWith('.mp4')) {
        modalVideo.src = src;
        modalVideo.style.display = 'block';
        modalImage.style.display = 'none';
    } else {
        modalImage.src = src;
        modalImage.style.display = 'block';
        modalVideo.style.display = 'none';
    }

    modal.style.display = 'block'; // Show the modal
}
// Function to close the modal
function closeModal() {
    const modal = document.getElementById('imageModal');
    modal.style.display = 'none'; // Hide the modal
}
// Refresh data function

async function refreshData() {
    try {
        console.log("Refresh button clicked"); // Debug line

        // Use GET method to hit the URL if POST is not allowed
        const response = await fetch('https://nallampatti-dashboard-api.onrender.com/update_data', {
            method: 'GET' // Change to GET since POST returned a 405 error
        });

        if (!response.ok) {
            throw new Error('Network response was not ok');
        }

        // Reload the page after a successful response
        location.reload();
    } catch (error) {
        console.error('Error refreshing data:', error);
    }
}

// Fetch data when the page loads
window.onload = async () => {
    const today = new Date().toLocaleDateString();
    document.getElementById('today-date').innerText = today;

    await fetchData(); // Fetch initial data
};

// Add event listener for refresh button
document.getElementById('refresh-button').addEventListener('click', refreshData);

</script>




</body>
</html>
